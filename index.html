<!doctype html>
<html>
<head>
    <title>Get Hype...</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
    <style>
        @font-face {
            font-family: "open-sans";
            src: url("https://mozorg.cdn.mozilla.net/media/fonts/OpenSans-Light-webfont.woff") format('woff');
        }
        .hype{
            font-family: "open-sans", "Times New Roman", sans-serif;
            font-size: 1em;
        }
        .hype-counter{
            font-size: .7em;
            margin-left: 2px;
        }
    </style>
</head>
<body>

<!--<span class="hype-button">-->
    <!--<span class="hype hype-logo">hype^</span>-->
    <!--<span class="hype hype-counter">0000000001</span>-->
<!--</span>-->

<script>

    (function($){

        function hypePad(num, size) {
            var s = num+"";
            while (s.length < size) s = "0" + s;
            return s;
        }

        function getHype(el){

            $.ajax({
                context: el,
                url: "http://localhost:3000/",
                dataType: 'jsonp',
                crossDomain: 'true',
                data: {
                    'set' : window.btoa(document.URL)
                },
                success: function(data){
                    document.getElementById($(this).attr('id'))
                                .getElementsByClassName('hype-counter')[0].innerHTML = hypePad(data.hype, 10);

                },
                error: function(err){
                    //run silent, run deep
                }
            });
        }

        $.widget('ui.hype', {
            _create: function(){

                var hypeId = 'hype-id-'+Math.floor((Math.random()*10000)+1);

                $('<span>',{
                   class: 'hype hype-logo',
                   html: 'hype^'
                }).appendTo($(this.element));

                $('<span>',{
                    class: 'hype hype-counter',
                    html: hypePad(1, 10)
                }).appendTo($(this.element));

                this.element.css({
                    'width': '96px',
                    'height': '24px',
                    'display': 'inline-block',
                    'font-family': 'open-sans',
                    'cursor' : 'pointer'
                });

                this.element.attr('id', hypeId);

                this.element.addClass('hype-container');

                this.element.on('click', function(e){
                    e.preventDefault();
                    getHype(document.getElementById(hypeId));
                });

                getHype(this.element);
            }
        });

    })(jQuery);

    $('<span>').hype().appendTo('body');

</script>
</body>
</html>
