<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>get_hype</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
    <style>
        @font-face {
            font-family: "open-sans";
            src: url("https://mozorg.cdn.mozilla.net/media/fonts/OpenSans-Light-webfont.woff") format('woff');
        }
        .hype-container{
            font-family: "open-sans", "Times New Roman", sans-serif;
            font-size: 1em;
            color: #777777;
            cursor : pointer;
        }
        .hype-logo{
            font-size: 1em;
        }
        .hype-counter{
            font-size: 0.7em;
        }
    </style>
</head>
<body>

<script>
    (function($){

        function hypePad(num, size) {
            var s = num+"";
            while (s.length < size) s = "0" + s;
            return s;
        }

        function getHype(el){

            var hypeId = window.btoa(document.URL + $(el).data('hype-id'));

            $.ajax({
                context: el,
                url: "http://hype-rulz.herokuapp.com",
                dataType: 'jsonp',
                crossDomain: 'true',
                data: {
                    'set' : hypeId
                },
                success: function(data){
                    $(this).find('.hype-counter').html(hypePad(data.hype, 10));

                },
                error: function(err){
                    //run silent, run deep
                }
            });
        }

        $.widget('ui.hype', {

            options: {
                attach: 'inner',
                logo: true,
                counter: true,
                hypeId : '',
                class : 'hype-container',
                userClasses: [],
                contain: false,
                clickAny: false,
                css: {
                    color: '#777777',
                    position: 'relative',
                    float : 'none'
                }
            },

            _init: function(){
                //nada
            },

            _create: function(){

                var classes = [];
                classes.push(this.options.class, this.options.userClasses);

                var hypeDiv = $('<span>',{
                    css: this.options.css
                }).addClass(classes.join(' '));

                $('<span>',{
                    class: 'hype-logo',
                    html: 'hype^'
                }).appendTo(hypeDiv);

                $('<span>',{
                    class: 'hype-counter',
                    html: hypePad(1, 10)
                }).appendTo(hypeDiv);

                if(this.options.contain){
                    var replacement = $('<div></div>', {
                        width: this.element.width(),
                        height: this.element.height()
                    });
                    replacement.append(this.element.clone(true));
                    this.element.replaceWith(replacement);
                    this.element = replacement;
                }

                switch(this.options.attach){
                    case 'inner':
                        hypeDiv.appendTo(this.element);
                        break;
                    case 'after':
                        hypeDiv.insertAfter(this.element);
                        break;
                    case 'before':
                        hypeDiv.insertBefore(this.element);
                        break;
                    default:
                        hypeDiv.appendTo(this.element);
                        break;
                }

                if(this.options.clickAny){
                    hypeDiv = $(hypeDiv.parents()[0]);
                }

                hypeDiv.on('click', function(e){
                    e.preventDefault();
                    getHype(this);
                });

                hypeDiv.data('hype-id', this.options.hypeId);

                getHype(hypeDiv);
            }
        });

    })(jQuery);

    $('body').hype({
        attach: 'inner',
        clickAny: true,
        css:{
            'font-size': '2em'
        }
    });

//    $('p').hype({
//        css: {
//            float: 'right'
//        },
//        hypeId : 'cool-p'
//    });
//
//    $('img').hype({
//        contain: true,
//        attach: 'inner',
//        css:{
//            float : 'none',
//            color: 'white',
//            top: '-20px'
//        },
//        hypeId : 'cool-yawn',
//        clickAny: true
//
//    });

</script>
</body>
</html>
